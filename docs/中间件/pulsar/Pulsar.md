## 介绍

### Producer

- 支持同步&异步方式发送消息
- 支持消息压缩：LZ4、ZLIB、ZSTD、SNAPPY
- 支持批处理：积累一个批次的消息发送到Pulsar。一个批次的消息被存储为一个单元。消息者消费完这个批次的全部消息后，这个单元才能被确认。
- 支持分块：将数据分成多个小的数据块发送到Pulsar，消费者接收一个消息的全部数据块，合成一条完整的数据在做处理。使用分块功能时，需要关闭批处理功能。

### Consumer

- 支持同步&异步方式接收消息： 同步-阻塞等待；异步-异步接收模式会立即返回一个 future 值，一旦收到新的消息就立刻完成。

- 监听

- 确认：当消费者成功的消费了一条消息，这个消费者会发送一个确认信息给broker。

- 取消确认：当消费者在某个时间没有成功的消费某条消息，消费者想重新消费到这条消息，这个消费者可以发送一条取消确认消息到 broker，broker 会将这条消息重新发给消费者。

  消息取消确认也有单条取消模式和累积取消模式 ，这依赖于消费者使用的订阅模式。

  在独占消费模式和灾备订阅模式中，消费者仅仅只能对收到的最后一条消息进行取消确认。

- 确认超时：如果消息没有被成功消费，你想去让 broker 自动重新交付这个消息， 你可以采用未确认消息自动重新交付机制。 客户端会跟踪 `超时` 时间范围内所有未确认的消息。 并且在指定超时时间后会发送一个 `重发未确认的消息` 请求到 broker。

- 死信主题：配置死信主题后，普通主题中的数据在重试失败一定次数后，会移到死信主题中。

- 重试主题：由于业务逻辑处理出现异常，消息一般需要被重新消费。 若需要允许延时重新消费失败的消息，你可以配置生产者同时发送消息到业务主题和重试主题，并允许消费者自动重试消费。 配置了允许消费者自动重试。如果消息没有被消费成功，它将被保存到重试主题当中。并在指定延时时间后，自动重新消费重试主题里面的消费失败消息。

### Topic

- Pulsar 支持两种主题类型：持久化和非持久化

- Topic组成：

  ```
  {persistent|non-persistent}://tenant/namespace/topic
  ```

  persistent|non-persistent： 持久化/非持久化

  tenant： 租户

  namespace： 命名空间

  topic： 主题

### 订阅

- Exclusive： 独占模式，`默认订阅模式`。
- Failover： 灾备模式
- Shard：共享模式
- Key_Shared：K-V对模式

### 多主题订阅

- 支持Pattern
- 支持Topic列表

### 消息保留和过期

- Pulsar broker默认如下：
  - 立即删除*所有*已经被cunsumer确认过的的消息
  - 以消息backlog的形式，[持久保存](https://pulsar.apache.org/docs/zh-CN/next/concepts-architecture-overview#persistent-storage)所有的未被确认消息

- Pulsar有两个特性，让你可以覆盖上面的默认行为。
  - 消息**存留**让你可以保存consumer确认过的消息
  - 消息**过期**让你可以给未被确认的消息设置存活时长（TTL）

### 消息去重

### 消息延迟投递